(function(n){"use strict";function e(n,t,i){if(typeof t=="string")if(t==="NoData")throw new Error("Surface elevation has no data.");else t=parseFloat(t);this.distanceFromSurface=t-i;this.penetrationOfSurface=n-this.distanceFromSurface;this.agl=n;this.surfaceElevation=t;this.terrainElevation=i}function i(t){return n.tileLayer("http://{s}.tile.thunderforest.com/"+t+"/{z}/{x}/{y}.png",{attribution:'Maps © <a href="http://www.thunderforest.com/">Thunderforest<\/a>, Data © <a href="//openstreetmap.org">OpenStreetMap<\/a> contributors',detectRetina:!0,subdomains:["a","b","c"]})}function o(n){var i=[];for(var t in n)n.hasOwnProperty(t)&&i.push([t,n[t]].join("="));return i.join("&")}function s(i,r){function u(n){function t(n,t){var r,u;r=document.createElement("dt");r.textContent=n;i.appendChild(r);u=document.createElement("dd");u.textContent=t;i.appendChild(u)}var i;return i=document.createElement("dl"),t("Penetrates Surface",n.penetratesSurface()?"Yes":"No"),t("Distance from Surface",n.distanceFromSurface+"′"),t("Penetration of Surface",n.penetrationOfSurface+"′"),t("AGL",n.agl+"′"),t("Surface Elev.",n.surfaceElevation+"′"),t("Terrain Elev.",n.terrainElevation+"′"),i}return n.marker(i,{icon:n.divIcon({html:r.surfaceElevation,className:r.penetratesSurface()?"elevation-div-icon penetrates-surface":"elevation-div-icon",iconSize:[30,13]})}).addTo(t).bindPopup(u(r))}function h(n){return new Promise(function(t,i){var u={x:n.lng,y:n.lat,units:"Feet",output:"json"},r=new XMLHttpRequest;r.open("get",["http://ned.usgs.gov/epqs/pqs.php",o(u)].join("?"));r.onloadend=function(){var n=JSON.parse(this.responseText);t(n.USGS_Elevation_Point_Query_Service.Elevation_Query)};r.onerror=function(n){i(n)};r.send()})}function c(t,i){return new Promise(function(r,u){n.esri.Tasks.identifyImage({url:t}).at(i).run(function(n,t,f){n?u(n):r({latlng:i,identifyImageResponse:t,rawResponse:f})})})}function l(n){var i,u,f=document.getElementById("aglBox"),t=f.value;t&&(t=parseInt(t,10));t>0?(i=c(r,n.latlng),u=h(n.latlng),Promise.all([i,u]).then(function(n){var r=n[0],i=n[1];console.debug("all response",arguments);var u=i.Elevation,f=r.identifyImageResponse.pixel.properties.value,o=new e(t,f,u);s([i.y,i.x],o).openPopup()},function(n){console.error("all error",n)})):alert("Undefined AGL")}var t,r,u,f;e.prototype.penetratesSurface=function(){return this.penetrationOfSurface>0};r="http://hqolymgis99t/arcgis/rest/services/Airport/AirportRasterTest/ImageServer";t=n.map("map",{center:[47.413220330159461,-120.80566406246835],zoom:7,maxZoom:18});n.control.scale().addTo(t);u=n.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'Map data &copy; <a href="//openstreetmap.org">OpenStreetMap<\/a> contributors, <a href="//creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA<\/a>',detectRetina:!0}).addTo(t);f=n.esri.Layers.imageMapLayer(r,{opacity:.5}).addTo(t);n.control.layers({OpenStreetMap:u,Landscape:i("landscape"),Transport:i("transport"),"Transport Dark":i("transport-dark"),OpenCycleMap:i("cycle"),Outdoors:i("outdoors")},{"Airport Surfaces":f}).addTo(t);t.on("click",l)})(L);
//# sourceMappingURL=index.min.js.map
